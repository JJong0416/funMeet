# ë»”(Fun)í•˜ì§€ë§Œ, ë»”í•˜ì§€ ì•Šì€ ëª¨ìŒ. FunMeet


### *ì§€ì—­ ë°œì „ì„ ìœ„í•œ ì·¨ë¯¸ ì¥ë ¤ í”Œë«í¼ (21.07 ~ 21.09)*

**Server** : [www.funmmet.shop](http://www.funmmet.shop)

**Docs** : [https://jjongdev.notion.site/FunMeet-Docs-c4cb032923504a0f8b07de84fbb94c4d](https://www.notion.so/FunMeet-Docs-c4cb032923504a0f8b07de84fbb94c4d)

**FunMeet**ì€ ì§€ì—­ê³¼ ì·¨ë¯¸ë¥¼ ìˆ˜ì§‘í•´ ê´€ì‹¬ ìˆëŠ” ì‚¬ëŒë“¤ë¼ë¦¬ ëª¨ì„ì„ ì¦ê¸¸ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” í”Œë«í¼(RESTful API) í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ì–´ë–¤ ëˆ„êµ¬ë„ ëª¨ì„(Club)ì„ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°, ëª¨ì„ ì•ˆì—ì„œ ë§Œë‚¨(Meeting)ì„ ì£¼ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì„¤ì •ëœ ì§€ì—­ ì •ë³´ì™€ ì·¨ë¯¸ë¥¼ ê°€ì§„ ëª¨ì„ì„ í™ë³´í•´ì£¼ëŠ” ê²ƒë¿ë§Œ ì•„ë‹ˆë¼, ì„œë¡œ ë§Œë‚¨ì„ ì£¼ì„ í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

ì¸í”„ë¼ì—ì„œë¶€í„° ë°±ì—”ë“œ ì„œë²„ê¹Œì§€ ì„¤ê³„ë¥¼ ì§„í–‰í–ˆìœ¼ë©°, ì „ë°˜ì ì¸ ì„œë²„ ê°œë°œê³¼ ì¸í”„ë¼ ì„¤ì •ì„ ì§‘ì¤‘ì ìœ¼ë¡œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

![ppt_1](https://user-images.githubusercontent.com/73544708/135741015-8c10ceef-6632-4327-9c4f-4dc5de54e28c.PNG)
---
![ppt_2](https://user-images.githubusercontent.com/73544708/135741018-20f91b92-d3dd-4d17-950d-9cd9a3ffd6e4.PNG)

## ê°œë°œ í™˜ê²½
> **Back-end**
> 
- Spring Boot
- Spring Data JPA
- Spring Security
- QueryDSL
- OAuth 2.0
- Gradle

> **Front-end**
> 
- Bootstrap v4.4.1
- jQuery v3.4.1
- Thymeleaf
- sweetAlert v2.1.2

> **Test**
> 
- Junit5
- docker (testContainer)

> **Database**
> 
- PostgreSQL

> **Infra**
> 
- Amazon EC2
- Amazon ROUTE53
- Aamzon RDS
- NGINX
   
   
## í”„ë¡œì íŠ¸ êµ¬ì¡°
![hierarchy_chap](https://user-images.githubusercontent.com/73544708/136200814-8787704c-d225-4306-a8f0-3dcb2e873e0e.PNG)

- í”„ë¡œì íŠ¸ ì„¤ê³„ë¥¼ í•˜ë©° íŒ¨í‚¤ì§€ ì „ëµì„ **ë ˆì´ì–´** ìš°ì„ ìœ¼ë¡œ í•  ì§€, **ëª¨ë“ˆ** ìš°ì„ ìœ¼ë¡œ í•  ì§€ ê³ ë¯¼ì„ í–ˆë‹¤.
- **ëª¨ë“ˆ** ìš°ì„  íŒ¨í‚¤ì§€ ì „ëµìœ¼ë¡œ ê°œë°œí–ˆì„ ë•Œ ìƒê¸°ëŠ” ë¬¸ì œ ( **ìˆœí™˜ì°¸ì¡°** ë°œìƒ, **ì¤‘ë³µì½”ë“œ** ë°œìƒ)ì„ **í…ŒìŠ¤íŠ¸ ì½”ë“œ**ë¡œ ì¡ì•„ì£¼ê³ , ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ê¸°ëŠ¥ì„ ì´ì‹í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•˜ê³  ë§Œë“¤
   
## DB ERD
![ERD](https://user-images.githubusercontent.com/73544708/136201176-6b48577e-c2ec-43d0-b4ac-5ebf929bb1cd.png)
   
## ë¶€ê°€Â **ê¸°ëŠ¥Â êµ¬í˜„**
- ì¹´ì¹´ì˜¤Â ë¡œê·¸ì¸(OAuthÂ 2.0)
- ëª¨ì„ í™ë³´ ì•Œë¦¼Â ì„œë¹„ìŠ¤(SMTP **asynchronous**)
- ìë™Â ë¡œê·¸ì¸(jdbcÂ TokenÂ &Â Cookie)
- ì¸ì¦Â ì´ë©”ì¼Â ì„œë¹„ìŠ¤

## ğŸ“¢í”„ë¡œì íŠ¸ Issue ë° í•´ê²°ì±…

- ë°œìƒí–ˆë˜ ë§ì€ ì´ìŠˆ ì¤‘, í•µì‹¬ì ì¸ ì´ìŠˆë¥¼ ê°€ì§€ê³  ì™”ë‹¤.

### 1. JPA N+1 Select

```java
@Override
    public Page<Club> findByKeyword(String keyword, Pageable pageable) {
        QClub club = QClub.club;
        JPQLQuery<Club> query = from(club).where(club.published.isTrue()
                .and(club.title.containsIgnoreCase(keyword))
                .or(club.hobby.any().title.containsIgnoreCase(keyword))
                .or(club.city.any().krCity.containsIgnoreCase(keyword)))
                .leftJoin(club.hobby, QHobby.hobby).fetchJoin()
                .leftJoin(club.city, QCity.city).fetchJoin()
                .leftJoin(club.members, QAccount.account).fetchJoin()
                .distinct();

        JPQLQuery<Club> pageableQuery = Objects.requireNonNull(getQuerydsl()).applyPagination(pageable, query);
        QueryResults<Club> fetchResults = pageableQuery.fetchResults();
        return new PageImpl<>(fetchResults.getResults(), pageable, fetchResults.getTotal());
    }
```

- ëª¨ì„ì„ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” ë„ì¤‘, **view**ì— ì—¬ëŸ¬ê°€ì§€ ì •ë³´ë¥¼ ë„ì–´ì£¼ê¸° ìœ„í•´ ì—¬ëŸ¬ê°€ì§€ Entityë¥¼ ë¶ˆëŸ¬ì™€ì•¼ í–ˆë‹¤.
- ê·¸ë ‡ì§€ë§Œ, ê°€ì ¸ì˜¤ëŠ” ë°ì´í„°ì˜ ì—°ê´€ ê´€ê³„ë¡œ ì¸í•´ ì¡°íšŒëœ ë°ì´í„° ê°œìˆ˜ Në§Œí¼ ì—°ê´€ê´€ê³„ì˜ ì¡°íšŒ ì¿¼ë¦¬ê°€ ì¶”ê°€ë¡œ ë°œìƒí•´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê²Œ ë˜ì—ˆë‹¤.
- í•´ê²°ë°©ì•ˆìœ¼ë¡œ, Fetch joinì„ í†µí•´ N+1 Select ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ë‹¤.
![í•˜ê¸°ì „](https://user-images.githubusercontent.com/73544708/136201400-385d73f7-70ee-447c-b8b0-99160f34253d.PNG)
![í•˜ê³ ë‚˜ì„œ_ìˆ˜í–‰ì‹œê°„](https://user-images.githubusercontent.com/73544708/136201449-ded9ea42-a520-4873-9687-519d3ea1899e.PNG)

- Fetch Joinì„ í†µí•´ ì¶”ê°€ë¡œ ë°œìƒí•˜ëŠ” ì¿¼ë¦¬ê°€ ì‚¬ë¼ì¡Œê¸° ë•Œë¬¸ì—, ì„±ëŠ¥ì ì¸ ë¶€ë¶„ì—ì„œ ìˆ˜í–‰ ì‹œê°„ì´ ë” ë¹¨ë¼ì¡Œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ê°€ ìˆë‹¤.

### 2. SMPT Mail Delivery Speed

```java
@Override
    public Executor getAsyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        int processors = Runtime.getRuntime().availableProcessors(); // ê°€ìš© í”„ë¡œì„¸ìŠ¤ ìˆ«ì
        executor.setCorePoolSize(processors);
        executor.setMaxPoolSize(processors * 2);
        executor.setQueueCapacity(50);
        executor.setKeepAliveSeconds(60);
        executor.setThreadNamePrefix("AsyncExecutor:");
        executor.initialize();
        return executor;
    }
```
![íšŒì›ê°€ì…](https://user-images.githubusercontent.com/73544708/136201667-3ade7a9d-5393-40d1-8387-4ce661848fa8.PNG)
- SMPTê°€ **HTMLì„ ê·¸ë ¤ ë³´ë‚´ì£¼ëŠ” ì‹œê°„ì´ ìƒë‹¹íˆ ì˜¤ë˜** ê±¸ë¦°ë‹¤.
- í™ë³´ ë©”ì„¸ì§€ë¥¼ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë³´ë‚´ì£¼ëŠ” ê³¼ì •ì—ì„œ ê¸°ì¡´ ì„œë¹„ìŠ¤ ë™ì‘ì†ë„ì— ì˜í–¥ì„ ì£¼ëŠ” ê²ƒì„ í™•ì¸í•˜ê³ , ê¸°ì¡´ ì„œë¹„ìŠ¤ ë¡œì§ì—ì„œ ì‹œê°„ì„ ì†Œë¹„í•˜ì§€ ì•Šê³  ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ê³ ë¯¼í–ˆë‹¤.
- ê·¸ ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” ThreadPoolì„ ì´ìš©í•œ 
**ë¹„ë™ê¸°**(asynchronous)ë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤. ****

### 3. Query Performance

```java
@EntityGraph(attributePaths = {"hobby","city"})
    Account findAccountWithHobbyAndCityById(Long id);

@EntityGraph(attributePaths = {"managers","members"})
    Club findClubWithManagersAndMembersById(Long id);
```

- í”„ë¡œì íŠ¸ ì´ˆë°˜ì— JPAë¥¼ ë‹¨ìˆœí•˜ê²Œ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì—, ì–´ë–¤ Queryë“¤ì´ ì¶”ê°€ì ìœ¼ë¡œ ë°œìƒí•˜ëŠ”ì§€ ëª¨ë¥´ê³  ì‚¬ìš©í•˜ì˜€ë‹¤.
- JPAë¥¼ ì‚¬ìš©í•˜ê¸° ì´ì „ì—, ì—°ê´€ ê´€ê³„ë¥¼ ë¬´ì‹œí•˜ê³  ì‘ì—…í–ˆê¸° ë•Œë¬¸ì— ë°œìƒí–ˆë˜ ë¬¸ì œë¡œ JPAë¼ëŠ” ê¸°ìˆ ì— ëŒ€í•´ ì¡°ê¸ˆ ë” í•µì‹¬ì ìœ¼ë¡œ ê³µë¶€í•˜ë©´ì„œ í”„ë¡œì íŠ¸ì— ì ‘ê·¼í•˜ì˜€ë‹¤.
   
   
## í”„ë¡œì íŠ¸ ê°œë°œ ì‹œ ì§‘ì¤‘í–ˆë˜ ë¶€ë¶„

---

### 1. ì§€ì†ì ì¸ Refactoring

![ëŠì„ì—†ëŠ” ê°œë°œ](https://user-images.githubusercontent.com/73544708/136201857-e0d7206e-93cb-43c8-ab39-5e90abf6fb02.PNG)

- ê°œë°œì„ ì§„í–‰í•˜ë©°, ì™„ì„±ëœ ê¸°ëŠ¥ì€ ê·¸ê²ƒìœ¼ë¡œ ë§ˆë¬´ë¦¬ í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ë³€í™”í•˜ëŠ” ë¶€ë¶„ì— ë§ì¶° ë¦¬íŒ©í† ë§ì„ í•©ë‹ˆë‹¤.
- ê°€ë…ì„±ë¿ë§Œ ì•„ë‹ˆë¼, í”„ë¡œì íŠ¸ ê¸°ê°„ ë™ì•ˆ Service ë¡œì§ì„ ìµœì í™”ì‹œí‚¤ë ¤ê³  ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.

### 2. ì„±ëŠ¥ í–¥ìƒ

- ê¸°ìˆ ì„ ë‹¨ìˆœí•˜ê²Œ ì“°ëŠ” ê²ƒì´ ì•„ë‹Œ, ê¸°ìˆ ì— ëŒ€í•´ í•™ìŠµì„ í•˜ê³  í•´ë‹¹ ê¸°ìˆ ì—ì„œ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ë©° í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

### 3. ì„œë¹„ìŠ¤ ì™„ì„± ë° ë°°í¬

- í”„ë¡œì íŠ¸ì˜ í”„ë¡ íŠ¸ë¶€í„° ë°±ì—”ë“œ ê·¸ë¦¬ê³  ì¸í”„ë¼ê¹Œì§€ Productì˜ í•œ ì‚¬ì´í´ì„ ëŒì•„ë³´ë©°, ê°œë°œì— ëŒ€í•œ ì „ë°˜ì ì¸ ê°œë…ê³¼ êµ¬ì¡°ì— ëŒ€í•´ ëšœë ·í•˜ê²Œ ì•Œê²Œ ë˜ì—ˆë‹¤.

   

