# í…ŒìŠ¤íŠ¸

# ë»”(Fun)í•˜ì§€ë§Œ, ë»”í•˜ì§€ ì•Šì€ ëª¨ìŒ. FunMeet

### *ì§€ì—­ ë°œì „ì„ ìœ„í•œ ì·¨ë¯¸ ì¥ë ¤ í”Œë«í¼ (21.08 ~ 22.03)*

**Server** : [www.funmmet.shop](http://www.funmmet.shop/)

**Docs** : [https://jjongdev.notion.site/FunMeet-Docs-c4cb032923504a0f8b07de84fbb94c4d](https://www.notion.so/FunMeet-Docs-c4cb032923504a0f8b07de84fbb94c4d)

**FunMeet**ì€ ì§€ì—­ê³¼ ì·¨ë¯¸ë¥¼ ìˆ˜ì§‘í•´ ê´€ì‹¬ ìˆëŠ” ì‚¬ëŒë“¤ë¼ë¦¬ ëª¨ì„ì„ ì¦ê¸¸ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” **í”Œë«í¼**ì…ë‹ˆë‹¤.

ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ì–´ë–¤ ëˆ„êµ¬ë„ ëª¨ì„(Club)ì„ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°, ëª¨ì„ ì•ˆì—ì„œ ë§Œë‚¨(Meeting)ì„ ì£¼ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì„¤ì •ëœ ì§€ì—­ ì •ë³´ì™€ ì·¨ë¯¸ë¥¼ ê°€ì§„ ëª¨ì„ì„ í™ë³´í•´ì£¼ëŠ” ê²ƒë¿ë§Œ ì•„ë‹ˆë¼, ì„œë¡œ ë§Œë‚¨ì„ ì£¼ì„ í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•´ì£¼ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.

![https://user-images.githubusercontent.com/73544708/135741015-8c10ceef-6632-4327-9c4f-4dc5de54e28c.PNG](https://user-images.githubusercontent.com/73544708/135741015-8c10ceef-6632-4327-9c4f-4dc5de54e28c.PNG)

![https://user-images.githubusercontent.com/73544708/135741018-20f91b92-d3dd-4d17-950d-9cd9a3ffd6e4.PNG](https://user-images.githubusercontent.com/73544708/135741018-20f91b92-d3dd-4d17-950d-9cd9a3ffd6e4.PNG)

## ê°œë°œ í™˜ê²½

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9698b174-3983-4ff2-b054-993881f61b3c/Untitled.png)

## í”„ë¡œì íŠ¸ êµ¬ì¡°

![https://user-images.githubusercontent.com/73544708/136200814-8787704c-d225-4306-a8f0-3dcb2e873e0e.PNG](https://user-images.githubusercontent.com/73544708/136200814-8787704c-d225-4306-a8f0-3dcb2e873e0e.PNG)

- í”„ë¡œì íŠ¸ ì„¤ê³„ë¥¼ í•˜ë©° íŒ¨í‚¤ì§€ ì „ëµì„ **ë ˆì´ì–´** ìš°ì„ ìœ¼ë¡œ í•  ì§€, **ëª¨ë“ˆ** ìš°ì„ ìœ¼ë¡œ í•  ì§€ ê³ ë¯¼ì„ í–ˆë‹¤.
- **ëª¨ë“ˆ** ìš°ì„  íŒ¨í‚¤ì§€ ì „ëµìœ¼ë¡œ ê°œë°œí–ˆì„ ë•Œ ìƒê¸°ëŠ” ë¬¸ì œ ( **ìˆœí™˜ì°¸ì¡°** ë°œìƒ, **ì¤‘ë³µì½”ë“œ** ë°œìƒ)ì„ **í…ŒìŠ¤íŠ¸ ì½”ë“œ**ë¡œ ì¡ì•„ì£¼ê³ , ëª¨ë“ˆ ë‹¨ìœ„ë¡œ ê¸°ëŠ¥ì„ ì´ì‹í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•˜ê³  ë§Œë“¤ì—ˆë‹¤.

## DB ERD

![https://user-images.githubusercontent.com/73544708/136201176-6b48577e-c2ec-43d0-b4ac-5ebf929bb1cd.png](https://user-images.githubusercontent.com/73544708/136201176-6b48577e-c2ec-43d0-b4ac-5ebf929bb1cd.png)

## ë¶€ê°€Â **ê¸°ëŠ¥Â êµ¬í˜„**

- ì¹´ì¹´ì˜¤Â ë¡œê·¸ì¸(OAuthÂ 2.0)
- ëª¨ì„ í™ë³´ ì•ŒëŒ ì„œë¹„ìŠ¤(SMTP **asynchronous**)
- ì¸ì¦Â ì´ë©”ì¼Â ì„œë¹„ìŠ¤

## ğŸ“¢í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ë¦¬íŒ©í† ë§ í•œ ë¶€ë¶„

### 1. **Mockitoë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ì½”ë“œ ë¦¬íŒ©í† ë§(ê¸°í•œ: 22.02.15 ~ 22.03.15)**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a5a7f2fa-3cff-4d91-b3e3-2396065b03d0/Untitled.png)

- Mockitoë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨, DBë¥¼ ì‚¬ìš©í•  í•„ìš”ì—†ì´, ìŠ¤í„°ë¹™(Stubbing) ëœ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤
ê¸° ë•Œë¬¸ì— **í…ŒìŠ¤íŠ¸ì½”ë“œì˜ ì‹œê°„ì„ ì¤„ì—¬**ì£¼ëŠ” ê²ƒ ë¿ë§Œ ì•„ë‹ˆë¼ **ë¦¬ì†ŒìŠ¤ë¥¼ ì ˆì•½**í•  ìˆ˜ ìˆë‹¤.
- ê°œë°œìê°€ **ê°ì²´ì˜ í–‰ë™ê¹Œì§€ ì¡°ì •**í•¨ìœ¼ë¡œì¨, ì¢€ **ë” ìœ ì—°í•œ í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ì‘ì„±**í•  ìˆ˜ ìˆê²Œ ë©
ë‹ˆë‹¤.

### 2. **ì´ë©”ì¼ ì„œë¹„ìŠ¤ ì „ëµíŒ¨í„´ìœ¼ë¡œ [ë¦¬íŒ©í† ë§](https://www.notion.so/7a09e87017364bc78c6b9b0a128917a0)(ê¸°í•œ : 22.02.08 ~ 22.02.10)**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/239873af-d782-4955-a156-f8b210e7a57f/Untitled.png)

- ì „ëµíŒ¨í„´ì˜ ê²½ìš°, **í´ë¼ì´ì–¸íŠ¸ê°€ ì „ëµì„ ìƒì„±í•´ ì „ëµì„ ì‹¤í–‰í•  ì»¨í…ìŠ¤íŠ¸ì— ì£¼ì…**í•´ì£¼ê¸° ë•Œ
ë¬¸ì— ì˜ì¡´ì„±ì„ ë°˜ëŒ€ë¡œ ê°€ì§€ê²Œ í•  ìˆ˜ ìˆë‹¤.
- ì´ë ‡ê²Œ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ ì£¼ì…í•´ì£¼ê²Œ ëœë‹¤ë©´, **ìœ ì§€ë³´ìˆ˜ì˜ ì´ì **ê³¼ **ìœ ì—°í•œ í…ŒìŠ¤íŠ¸ì½”ë“œ**ë¥¼
ì‘ì„±í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.

### 3. **Spring Controller-Service ì±…ì„ ë‹¤ì‹œ ë‚˜ëˆ„ê¸°(ê¸°í•œ: 22.01.02 ~ 22.01.06)**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a64b74df-59dc-434b-95eb-3f278ebdfea9/Untitled.png)

- ì±…ì„(Layer)ì„ ë¶„ë¦¬í•¨ìœ¼ë¡œì¨, **ì»´í¬ë„ŒíŠ¸ë“¤ì˜ ì„œë¡œì˜ ì˜ì¡´ ê³„ì¸µ ê´€ê³„ë¥¼ ê¹”ë”í•˜ê²Œ ìœ ì§€**í•  ìˆ˜ ìˆ
ë‹¤.

## ğŸ³ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ê²ªì€ ì´ìŠˆ ì²˜ë¦¬ë°©ì‹ê³¼ ìƒê°

### 1. N+1 Selector ì´ìŠˆì™€ Query ìµœì í™”

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/95ab7ece-2f56-424f-a906-89cf7311d50c/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8955532f-0c0b-4617-ab70-e713f73aa2dc/Untitled.png)

- AOPë¥¼ í†µí•´ ê° ì¿¼ë¦¬ë“¤ê³¼ ë©”ì†Œë“œì˜ ì‹œê°„ì„ ì²´í¬í•´ ê°€ë©°, ì–´ëŠ ë¶€ë¶„ì— ë³‘ëª©í˜„ìƒì´ ìˆì—ˆëŠ” ì§€
í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- ê·¸ëŸ¬ë˜ ì¤‘, ì„¤ê³„í–ˆë˜ ë¶€ë¶„ì˜ ì¿¼ë¦¬ì™€ ë‹¤ë¥¸ ì¿¼ë¦¬ë¥¼ DBì— ì°Œë¥´ëŠ” ë¶€ë¶„ì„ ë°œê²¬
- **fetch joinì„ í†µí•´ ì¶”ê°€ì ì¸ ì¿¼ë¦¬ ë°œìƒ(N+1 Select)** ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ìœ¼ë©°, ê° ì¿¼ë¦¬ë“¤ì˜ ìµœì 
ì¿¼ë¦¬ë¥¼ ì‘ì„±í•¨ìœ¼ë¡œ ì„±ëŠ¥ ì´ìŠˆì— ëŒ€í•´ ìµœì†Œí™” ì‹œì¼°ë‹¤.

```java
@Override
    public Page<Club> findByKeyword(String keyword, Pageable pageable) {
        QClub club = QClub.club;
        JPQLQuery<Club> query = from(club).where(club.published.isTrue()
                .and(club.title.containsIgnoreCase(keyword))
                .or(club.hobby.any().title.containsIgnoreCase(keyword))
                .or(club.city.any().krCity.containsIgnoreCase(keyword)))
                .leftJoin(club.hobby, QHobby.hobby).fetchJoin()
                .leftJoin(club.city, QCity.city).fetchJoin()
                .leftJoin(club.members, QAccount.account).fetchJoin()
                .distinct();

        JPQLQuery<Club> pageableQuery = Objects.requireNonNull(getQuerydsl()).applyPagination(pageable, query);
        QueryResults<Club> fetchResults = pageableQuery.fetchResults();
        return new PageImpl<>(fetchResults.getResults(), pageable, fetchResults.getTotal());
    }

```

### 2. SMPT Mail Delivery Speed

![https://user-images.githubusercontent.com/73544708/136201667-3ade7a9d-5393-40d1-8387-4ce661848fa8.PNG](https://user-images.githubusercontent.com/73544708/136201667-3ade7a9d-5393-40d1-8387-4ce661848fa8.PNG)

- íŠ¹ì • ì´ë¯¸ì§€ë¥¼ ë©”ì¼ì„ í†µí•´ ë°œì†¡í•˜ëŠ” ë¶€ë¶„ì—ì„œ ë§ì€ ì‹œê°„ê³¼ ë¦¬ì†ŒìŠ¤ë¥¼ ì¡ì•„ë¨¹ëŠ” ê²ƒì„ í™•ì¸
- í™ë³´ ë©”ì„¸ì§€ë¥¼ **ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë³´ë‚´ì£¼ëŠ” ê³¼ì •ì—ì„œ ê¸°ì¡´ ì„œë¹„ìŠ¤ ë™ì‘ì†ë„ì— ì˜í–¥ì„ ì£¼ëŠ” ê²ƒì„ í™•ì¸**í•˜ê³ , **ê¸°ì¡´ ì„œë¹„ìŠ¤ ë¡œì§ì—ì„œ ì‹œê°„ì„ ì†Œë¹„í•˜ì§€ ì•Šê³  ì „ì†¡í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ê³ ë¯¼**í–ˆë‹¤.
- ê·¸ ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” ThreadPoolì„ ì´ìš©í•œ **ë¹„ë™ê¸°**(asynchronous)ë¥¼ ì‚¬ìš©í•˜ì˜€ë‹¤.

```java
@Override
    public Executor getAsyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        int processors = Runtime.getRuntime().availableProcessors();//ê°€ìš© í”„ë¡œì„¸ìŠ¤ ìˆ«ì
        executor.setCorePoolSize(processors);
        executor.setMaxPoolSize(processors * 2);
        executor.setQueueCapacity(50);
        executor.setKeepAliveSeconds(60);
        executor.setThreadNamePrefix("AsyncExecutor:");
        executor.initialize();
        return executor;
    }
```

### 3. í•˜ì´ë²„ë„¤ì´íŠ¸ MultipleBagFetchException

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4b032f41-b4f5-4312-8ad5-9e2d5dd2a556/Untitled.png)

- Data JPAë¥¼ ì‚¬ìš© ì¤‘, **`org.hibernate.loader.MultipleBagFetchException: cannot simultaneously
fetch multiple bags`** ì´ë€ ë©”ì„¸ì§€ê°€ ë°œìƒí–ˆë‹¤.
- OneToMany, ManyToManyì—ì„œ í•œ ì—”í‹°í‹°ì—ì„œ ë‘ ê°œ ì´ìƒì„ EAGERë¡œ fetch í–ˆì„ ë•Œ ë°œìƒ í•˜ì˜€ë‹¤.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/14513c20-03b6-4fb1-bc92-f7e140dc7942/Untitled.png)

- LAZYë¡œ í•´ë„ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí–ˆê³ , ì§ì ‘ MultipleBagFetchExceptionì„ í™•ì¸í•´ë³´ë‹ˆ,
BagTypeì„ ë™ì‹œì— fetch í•´ ì˜¬ ë•Œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë¼ê³  í•œë‹¤.
- Bag(Multiset)ì€ Setê³¼ ê°™ì´ ìˆœì„œê°€ ì—†ê³ , Listì™€ ê°™ì´ ì¤‘ë³µì„ í—ˆìš©í•˜ëŠ” ìë£Œêµ¬ì¡°ì´ê³ , ìë°”
ì»¬ë ‰ì…˜ í”„ë ˆì„ì›Œí¬ì—ì„  Bagê°€ ì—†ê¸° ë•Œë¬¸ì— í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„  Listë¥¼ Bagë¡œì¨ ì‚¬ìš©í•˜ê³  ìˆë˜
ê²ƒì´ë‹¤.
- ë¬¸ì œê°€ ë°œìƒí•˜ë˜ ê³³ì„ Listê°€ ì•„ë‹Œ Setì„ í†µí•´ ë¬¸ì œë¥¼ í•´ê²°í–ˆë‹¤.

## í”„ë¡œì íŠ¸ ê°œë°œ ì‹œ ì§‘ì¤‘í–ˆë˜ ë¶€ë¶„

---

### 1. ì§€ì†ì ì¸ Refactoring

![https://user-images.githubusercontent.com/73544708/136201857-e0d7206e-93cb-43c8-ab39-5e90abf6fb02.PNG](https://user-images.githubusercontent.com/73544708/136201857-e0d7206e-93cb-43c8-ab39-5e90abf6fb02.PNG)

- ê°œë°œì„ ì§„í–‰í•˜ë©°, ì™„ì„±ëœ ê¸°ëŠ¥ì€ ê·¸ê²ƒìœ¼ë¡œ ë§ˆë¬´ë¦¬ í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ë³€í™”í•˜ëŠ” ë¶€ë¶„ì— ë§ì¶° ë¦¬íŒ©í† ë§ì„ í•©ë‹ˆë‹¤.
- ê°€ë…ì„±ë¿ë§Œ ì•„ë‹ˆë¼, í”„ë¡œì íŠ¸ ê¸°ê°„ ë™ì•ˆ Service ë¡œì§ì„ ìµœì í™”ì‹œí‚¤ë ¤ê³  ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.

### 2. ì„±ëŠ¥ í–¥ìƒ

- ê¸°ìˆ ì„ ë‹¨ìˆœí•˜ê²Œ ì“°ëŠ” ê²ƒì´ ì•„ë‹Œ, ê¸°ìˆ ì— ëŒ€í•´ í•™ìŠµì„ í•˜ê³  í•´ë‹¹ ê¸°ìˆ ì—ì„œ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ë©° í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

### 3. ì„œë¹„ìŠ¤ ì™„ì„± ë° ë°°í¬

- í”„ë¡œì íŠ¸ì˜ í”„ë¡ íŠ¸ë¶€í„° ë°±ì—”ë“œ ê·¸ë¦¬ê³  ì¸í”„ë¼ê¹Œì§€ Productì˜ í•œ ì‚¬ì´í´ì„ ëŒì•„ë³´ë©°, ê°œë°œì— ëŒ€í•œ ì „ë°˜ì ì¸ ê°œë…ê³¼ êµ¬ì¡°ì— ëŒ€í•´ ëšœë ·í•˜ê²Œ ì•Œê²Œ ë˜ì—ˆë‹¤.
